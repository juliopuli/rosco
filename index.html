<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasapalabra Pro v3.6.0</title>
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#050a1f">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --fondo: #050a1f; --panel: #111b3d; --oro: #ffcc00; --verde: #2ecc71; --rojo: #dc3545; --azul: #0044ff; }
        body { background: var(--fondo); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .oculto { display: none !important; }

        /* PANTALLAS */
        .pantalla { text-align: center; background: var(--panel); padding: 35px; border-radius: 25px; border: 1px solid #2a3a6d; width: 90%; max-width: 380px; box-shadow: 0 20px 60px rgba(0,0,0,0.7); }
        input { width: 85%; padding: 14px; margin: 10px 0; border-radius: 10px; border: none; font-size: 1rem; text-align: center; background: #e0e0e0; color: #111; font-weight: bold; }
        .btn { width: 100%; padding: 16px; margin: 10px 0; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .btn-green { background: var(--verde); color: white; }
        .btn-blue { background: #3498db; color: white; }
        .btn-red { background: var(--rojo); color: white; }

        /* BLOQUEO */
        .bloqueo-msg { color: var(--rojo); font-weight: bold; font-size: 1.2rem; margin-top: 20px; border: 2px solid var(--rojo); padding: 15px; border-radius: 10px; background: rgba(220, 53, 69, 0.1); }

        /* PANEL ADMIN */
        #panel-staff { display: none; position: fixed; top: 15px; right: 15px; background: rgba(0,0,0,0.95); border: 2px solid var(--oro); padding: 15px; border-radius: 15px; z-index: 1000; min-width: 180px; text-align: center; }
        .badge { font-size: 0.7rem; font-weight: bold; padding: 3px 8px; border-radius: 5px; text-transform: uppercase; }
        .badge-super { background: var(--rojo); color: white; }

        /* JUEGO */
        #juego-cont { display: none; width: 100vw; height: 100vh; position: relative; }
        .rosco { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 480px; height: 480px; }
        .letra { position: absolute; width: 40px; height: 40px; background: var(--azul); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; color: white; transition: 0.3s; }
        .letra.activa { background: var(--oro) !important; color: #000; transform: scale(1.3); box-shadow: 0 0 20px var(--oro); }
    </style>
</head>
<body>

    <div id="panel-staff">
        <div id="staff-info">
            <span id="staff-name">---</span><br>
            <span id="staff-tag" class="badge">ROL</span>
        </div>
        <hr style="border:0.5px solid #444; margin:10px 0;">
        <div id="status-lock" style="font-size:0.8rem; margin-bottom:10px;">ESTADO: <b style="color:var(--verde)">ACTIVO</b></div>
        <button id="btn-master-toggle" class="btn-red" style="padding:8px; font-size:0.7rem;" onclick="toggleSeguridad()">BLOQUEAR JUEGO</button>
    </div>

    <div id="p-login" class="pantalla">
        <h1 style="color:var(--oro); margin-bottom:5px;">PASAPALABRA</h1>
        <p id="subtitulo" style="font-size:0.9rem; color:#aaa;">Introduce tu nombre para jugar</p>
        
        <input type="text" id="nombre-input" placeholder="Tu nombre aquí...">
        
        <div id="auth-staff" class="oculto">
            <input type="text" id="user-staff" placeholder="Usuario Staff">
            <input type="password" id="pass-staff" placeholder="Contraseña">
        </div>

        <button id="btn-entrar" class="btn btn-green" onclick="procesarEntrada()">ENTRAR</button>

        <div id="msg-bloqueo" class="bloqueo-msg oculto">
            ⚠️ ACCESO BLOQUEADO POR EL SUPERADMIN
        </div>
    </div>

    <div id="p-menu" class="pantalla oculto">
        <h2 id="user-welcome">BIENVENIDO</h2>
        <button class="btn btn-blue" onclick="irOnline()">MODO ONLINE</button>
        <button class="btn btn-green" onclick="iniciarLocal()">MODO LOCAL</button>
        <button class="btn" style="background:#444;" onclick="location.reload()">SALIR</button>
    </div>

    <div id="p-online" class="pantalla oculto">
        <h2>ONLINE</h2>
        <button class="btn btn-blue" onclick="crearSala()">CREAR SALA</button>
        <input type="text" id="join-id" placeholder="Código de sala">
        <button class="btn btn-green" onclick="conectarSala()">UNIRSE</button>
        <h1 id="display-id" style="color:var(--oro)"></h1>
    </div>

    <div id="juego-cont">
        <div class="rosco" id="rosco-div"></div>
        <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; width:280px;">
            <div id="pregunta-box" style="font-weight:bold; min-height:60px;">Cargando...</div>
            <input type="text" id="ans-input" placeholder="Respuesta...">
            <button class="btn btn-green" onclick="check()">ENVIAR</button>
            <button class="btn" style="background:var(--oro); color:black" onclick="skip()">PASAPALABRA</button>
        </div>
    </div>

<script>
    // CONFIGURACIÓN CLAVE
    const CODIGO_SECRETO_STAFF = "STAFF77";
    const staffDB = {
        "pablo": { pass: "Pablo23sek", rango: "SUPERADMIN", power: true },
        "juliopuli": { pass: "juli26", rango: "ADMIN", power: false },
        "alvarito": { pass: "poki", rango: "VISUALIZADOR", power: false }
    };

    let miNombre = "", miRol = "", modo = "", conn = null;
    // El bloqueo se guarda en el navegador del dispositivo que lo activa
    let sistemaBloqueado = localStorage.getItem('globalLock') === 'true';

    function procesarEntrada() {
        const val = document.getElementById('nombre-input').value.trim();
        
        // 1. ¿INTENTA ACCEDER AL LOGIN STAFF?
        if (val === CODIGO_SECRETO_STAFF) {
            document.getElementById('subtitulo').innerText = "MODO ADMINISTRADOR";
            document.getElementById('nombre-input').classList.add('oculto');
            document.getElementById('auth-staff').classList.remove('oculto');
            document.getElementById('btn-entrar').onclick = loginStaff;
            return;
        }

        // 2. ¿EL SISTEMA ESTÁ BLOQUEADO?
        if (sistemaBloqueado) {
            document.getElementById('msg-bloqueo').classList.remove('oculto');
            document.getElementById('nombre-input').disabled = true;
            document.getElementById('btn-entrar').classList.add('oculto');
            return;
        }

        // 3. ENTRADA NORMAL
        if (val.length < 2) return alert("Nombre demasiado corto");
        miNombre = val;
        irMenu();
    }

    function loginStaff() {
        const u = document.getElementById('user-staff').value.toLowerCase();
        const p = document.getElementById('pass-staff').value;

        if (staffDB[u] && staffDB[u].pass === p) {
            miNombre = u.toUpperCase();
            miRol = staffDB[u].rango;
            
            // Mostrar Panel
            document.getElementById('panel-staff').style.display = "block";
            document.getElementById('staff-name').innerText = miNombre;
            document.getElementById('staff-tag').innerText = miRol;
            if(u === "pablo") document.getElementById('staff-tag').classList.add('badge-super');

            // Solo Pablo puede ver el botón de bloqueo si tiene "power"
            if (!staffDB[u].power) {
                document.getElementById('btn-master-toggle').classList.add('oculto');
            }
            
            actualizarUIBloqueo();
            irMenu();
        } else {
            alert("Credenciales incorrectas");
        }
    }

    function toggleSeguridad() {
        sistemaBloqueado = !sistemaBloqueado;
        localStorage.setItem('globalLock', sistemaBloqueado);
        actualizarUIBloqueo();
        alert(sistemaBloqueado ? "JUEGO BLOQUEADO" : "JUEGO ACTIVADO");
    }

    function actualizarUIBloqueo() {
        const st = document.getElementById('status-lock');
        const btn = document.getElementById('btn-master-toggle');
        if (sistemaBloqueado) {
            st.innerHTML = "ESTADO: <b style="color:var(--rojo)">BLOQUEADO</b>";
            btn.innerText = "REABRIR JUEGO";
            btn.className = "btn-green";
            btn.style.padding = "8px";
        } else {
            st.innerHTML = "ESTADO: <b style="color:var(--verde)">ACTIVO</b>";
            btn.innerText = "BLOQUEAR JUEGO";
            btn.className = "btn-red";
            btn.style.padding = "8px";
        }
    }

    // --- NAVEGACIÓN ---
    function irMenu() {
        document.querySelectorAll('.pantalla').forEach(p => p.classList.add('oculto'));
        document.getElementById('p-menu').classList.remove('oculto');
        document.getElementById('user-welcome').innerText = "HOLA, " + miNombre;
    }

    function irOnline() {
        document.getElementById('p-menu').classList.add('oculto');
        document.getElementById('p-online').classList.remove('oculto');
    }

    function iniciarLocal() {
        document.getElementById('p-menu').classList.add('oculto');
        document.getElementById('juego-cont').style.display = "block";
        document.getElementById('display-nombre').innerText = miNombre;
        // (Aquí iría la lógica del rosco ya programada antes)
    }

    // El resto de la lógica de PeerJS y el Rosco se mantiene igual que la v3.4.1
</script>
</body>
</html>
