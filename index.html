<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasapalabra Pro v4.6.0</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --fondo: #050a1f; --panel: #111b3d; --oro: #ffcc00; --verde: #2ecc71; --rojo: #dc3545; --azul: #00c6ff; }
        body { background: var(--fondo); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; overflow: hidden; }
        .oculto { display: none !important; }

        .pantalla { text-align: center; background: var(--panel); padding: 30px; border-radius: 20px; border: 1px solid #2a3a6d; width: 90%; max-width: 400px; box-shadow: 0 0 50px rgba(0,0,0,0.8); z-index: 10; }
        
        .btn { width: 100%; padding: 14px; margin: 8px 0; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.9rem; color: white; transition: 0.3s; }
        .btn-green { background: var(--verde); }
        .btn-blue { background: var(--azul); color: #000; }
        .btn-red { background: var(--rojo); }
        .btn-face { background: linear-gradient(90deg, #00c6ff, #0072ff); border: 1px solid #fff; }
        .btn-staff { background: transparent; color: #555; font-size: 0.7rem; margin-top: 15px; border: 1px solid #333; }

        input { width: 90%; padding: 12px; margin: 5px 0; border-radius: 8px; border: none; text-align: center; font-size: 1rem; background: #eee; color: #000; font-weight: bold; }

        /* JUEGO */
        #juego-cont { display: none; width: 100vw; height: 100vh; position: fixed; top:0; left:0; background: var(--fondo); z-index: 100; }
        .rosco-main { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; height: 400px; }
        .letra { position: absolute; width: 35px; height: 35px; background: #0044ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; font-size: 0.8rem; }

        /* C√ÅMARA */
        #cam-box { width: 200px; height: 200px; margin: 10px auto; border-radius: 50%; border: 4px solid var(--azul); overflow: hidden; display: none; position: relative; }
        #v-feed { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .scan-anim { position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--oro); box-shadow: 0 0 15px var(--oro); animation: scanMove 2s infinite; }
        @keyframes scanMove { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }

        #hud-staff { display: none; position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.9); border: 1px solid var(--oro); padding: 10px; border-radius: 10px; z-index: 1000; text-align: center; }
    </style>
</head>
<body>

    <div id="hud-staff">
        <small id="hud-txt" style="color:var(--oro)"></small><br>
        <button id="btn-master-lock" class="oculto" style="background:var(--rojo); color:white; border:none; padding:5px; margin:5px; cursor:pointer; font-weight:bold;"></button><br>
        <button class="btn-blue" style="font-size:0.6rem; padding:4px;" onclick="registrarEstaCara()">üì∏ REGISTRAR MI CARA</button>
        <button style="background:#333; color:white; border:none; padding:4px; margin-top:5px; cursor:pointer;" onclick="location.reload()">SALIR</button>
    </div>

    <div id="p-login" class="pantalla">
        <h1 style="color:var(--oro)">PASAPALABRA</h1>
        <input type="text" id="n-jugador" placeholder="Tu nombre...">
        <button class="btn btn-green" onclick="entrarComoJugador()">ENTRAR</button>
    </div>

    <div id="p-locked" class="pantalla oculto">
        <h1 style="color:var(--rojo)">üîí BLOQUEADO</h1>
        <p>Sistema cerrado temporalmente.</p>
        <button class="btn btn-staff" onclick="irAStaffAcceso()">ACCESO STAFF</button>
    </div>

    <div id="p-menu" class="pantalla oculto">
        <h2 id="saludo">HOLA</h2>
        <button class="btn btn-blue" onclick="irOnline()">MODO ONLINE</button>
        <button class="btn btn-green" onclick="irLocal()">MODO LOCAL</button>
        <button class="btn btn-staff" onclick="irAStaffAcceso()">ACCESO STAFF</button>
    </div>

    <div id="p-staff-ops" class="pantalla oculto">
        <h3>ACCESO RESTRINGIDO</h3>
        <div id="manual-login">
            <input type="text" id="user-st" placeholder="Usuario">
            <input type="password" id="pass-st" placeholder="Contrase√±a">
            <button class="btn btn-green" onclick="validaManual()">ENTRAR</button>
        </div>
        <hr>
        <button class="btn btn-face" onclick="mostrarFaceID()">üëÅÔ∏è FACE ID POR CATEGOR√çA</button>
        <button class="btn btn-staff" onclick="location.reload()">ATR√ÅS</button>
    </div>

    <div id="p-face-scan" class="pantalla oculto">
        <h3>BIOMETR√çA</h3>
        <input type="text" id="rank-to-scan" placeholder="PON TU CATEGOR√çA AQU√ç">
        <div id="cam-box">
            <video id="v-feed" autoplay playsinline></video>
            <div class="scan-anim"></div>
        </div>
        <button id="btn-do-scan" class="btn btn-blue" onclick="ejecutarEscaneo()">INICIAR ESCANEO</button>
        <p id="face-msg"></p>
    </div>

    <div id="juego-cont">
        <div class="rosco-main" id="rosco-box"></div>
        <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; width:280px;">
            <div id="txt-pregunta" style="font-weight:bold; margin-bottom:10px;">Cargando...</div>
            <input type="text" id="input-resp" placeholder="Respuesta...">
            <button class="btn btn-green" onclick="alert('Enviado')">ENVIAR</button>
        </div>
    </div>

<script>
    const CLAVE_SECRETA = "Pablo23sek";
    const DB = {
        "pablo": { pass: "Pablo23sek", rank: "SUPERADMIN", super: true },
        "juliopuli": { pass: "juli26", rank: "ADMIN", super: false }
    };

    let isLocked = localStorage.getItem('isLocked') === 'true';
    let currentUser = "";

    function entrarComoJugador() {
        const n = document.getElementById('n-jugador').value;
        if(isLocked) { cambiarPantalla('p-locked'); }
        else if(n) { currentUser = n; irAMenu(); }
    }

    function irAMenu() {
        cambiarPantalla('p-menu');
        document.getElementById('saludo').innerText = "HOLA, " + currentUser.toUpperCase();
    }

    function irAStaffAcceso() {
        if(prompt("C√ìDIGO STAFF:") === CLAVE_SECRETA) cambiarPantalla('p-staff-ops');
    }

    function validaManual() {
        const u = document.getElementById('user-st').value.toLowerCase();
        const p = document.getElementById('pass-st').value;
        if(DB[u] && DB[u].pass === p) loginSuccess(u);
        else alert("Datos incorrectos");
    }

    // --- FACE ID ---
    function mostrarFaceID() { cambiarPantalla('p-face-scan'); }

    async function ejecutarEscaneo() {
        const categoria = document.getElementById('rank-to-scan').value.toUpperCase().trim();
        const msg = document.getElementById('face-msg');
        
        // Buscar usuario por rango
        let targetUser = Object.keys(DB).find(key => DB[key].rank === categoria);
        
        if(!targetUser) return alert("Categor√≠a no v√°lida");
        
        // COMPROBAR SI EST√Å GUARDADO
        if(localStorage.getItem('face_reg_' + targetUser) !== 'true') {
            msg.innerText = "Error: Esa categor√≠a no ha registrado su cara a√∫n.";
            return;
        }

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            document.getElementById('cam-box').style.display = "block";
            document.getElementById('v-feed').srcObject = stream;
            msg.innerText = "Analizando rostro para: " + categoria;
            
            setTimeout(() => {
                stream.getTracks().forEach(t => t.stop());
                loginSuccess(targetUser);
            }, 3000);
        } catch(e) { alert("C√°mara no disponible"); }
    }

    function loginSuccess(u) {
        currentUser = u;
        const hud = document.getElementById('hud-staff');
        hud.style.display = "block";
        document.getElementById('hud-txt').innerText = u.toUpperCase() + " (" + DB[u].rank + ")";
        
        if(DB[u].super) {
            const bl = document.getElementById('btn-master-lock');
            bl.classList.remove('oculto');
            bl.innerText = isLocked ? "üîì ABRIR JUEGO" : "üîí CERRAR JUEGO";
            bl.onclick = () => {
                isLocked = !isLocked;
                localStorage.setItem('isLocked', isLocked);
                location.reload();
            };
        }
        irAMenu();
    }

    function registrarEstaCara() {
        const u = currentUser.toLowerCase();
        if(confirm("¬øQuieres registrar tu cara para " + u.toUpperCase() + "?")) {
            localStorage.setItem('face_reg_' + u, 'true'); // GUARDADO PERMANENTE
            alert("‚úÖ Rostro vinculado a " + DB[u].rank + ". Ya puedes entrar con Face ID.");
        }
    }

    // --- BOTONES JUEGO ---
    function irLocal() {
        document.querySelectorAll('.pantalla').forEach(p => p.classList.add('oculto'));
        document.getElementById('juego-cont').style.display = "block";
        pintaRosco();
    }

    function irOnline() {
        alert("Buscando servidores...");
        irLocal(); // Redirige al rosco para que funcione
    }

    function pintaRosco() {
        const box = document.getElementById('rosco-box');
        box.innerHTML = "";
        const abc = "ABCDEFGHIJKLMN√ëOPQRSTUVWXY Z".split("");
        abc.forEach((l, i) => {
            const d = document.createElement('div');
            d.className = "letra"; d.innerText = l;
            const a = (i * (360/26)) - 90;
            const r = a * (Math.PI / 180);
            const x = Math.cos(r) * 180;
            const y = Math.sin(r) * 180;
            d.style.left = `calc(50% + ${x}px - 17px)`;
            d.style.top = `calc(50% + ${y}px - 17px)`;
            box.appendChild(d);
        });
    }

    function cambiarPantalla(id) {
        document.querySelectorAll('.pantalla').forEach(p => p.classList.add('oculto'));
        document.getElementById(id).classList.remove('oculto');
    }
</script>
</body>
</html>
