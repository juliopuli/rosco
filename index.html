<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PASAPALABRA ULTIMATE CYBER-EDITION v10</title>
    <style>
        /* =========================================
           1. CORE STYLES & VARIABLES
           ========================================= */
        :root {
            --bg-dark: #020204;
            --bg-panel: rgba(10, 20, 40, 0.85);
            --neon-blue: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-green: #0aff0a;
            --neon-red: #ff003c;
            --neon-gold: #ffd700;
            --glass: rgba(255, 255, 255, 0.05);
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
        }

        * { box-sizing: border-box; user-select: none; }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark);
            color: white;
            font-family: var(--font-main);
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* CANVA DE FONDO */
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* EFECTO CRT (SCANLINES) */
        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.4;
        }

        /* =========================================
           2. UI COMPONENTS & LAYOUT
           ========================================= */
        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease-in-out;
        }

        .screen.active {
            opacity: 1;
            pointer-events: all;
        }

        .panel-glass {
            background: var(--bg-panel);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.1);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            position: relative;
            overflow: hidden;
            transform: perspective(1000px) rotateX(0deg);
            transition: transform 0.3s;
        }

        /* TITULOS ANIMADOS */
        h1.cyber-title {
            font-size: 3rem;
            margin: 0 0 20px 0;
            text-transform: uppercase;
            font-weight: 900;
            letter-spacing: 5px;
            color: white;
            text-shadow: 
                0 0 5px var(--neon-blue),
                0 0 10px var(--neon-blue),
                0 0 20px var(--neon-blue);
            animation: glitch-anim 3s infinite alternate-reverse;
        }

        h2 { font-weight: 300; letter-spacing: 2px; margin-bottom: 30px; color: #aaa; }

        /* INPUTS FUTURISTAS */
        .cyber-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0,0,0,0.5);
            border: 2px solid #333;
            border-radius: 5px;
            color: var(--neon-blue);
            font-family: var(--font-mono);
            font-size: 1.2rem;
            text-align: center;
            transition: 0.3s;
            outline: none;
        }

        .cyber-input:focus {
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        /* BOTONES */
        .btn {
            display: inline-block;
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: black;
            border: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: 0.3s;
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }

        .btn-primary {
            background: var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue);
        }
        .btn-primary:hover { background: white; box-shadow: 0 0 20px white; }

        .btn-start {
            background: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
        }
        
        .btn-staff {
            background: transparent;
            border: 1px solid #444;
            color: #666;
            font-size: 0.8rem;
            margin-top: 30px;
        }
        .btn-staff:hover { border-color: var(--neon-red); color: var(--neon-red); }

        /* =========================================
           3. GAME INTERFACE (THE ROSCO)
           ========================================= */
        #game-layout {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .rosco-container {
            position: relative;
            width: 500px;
            height: 500px;
            margin-bottom: 30px;
            border-radius: 50%;
            border: 2px dashed rgba(255,255,255,0.1);
            animation: spin-slow 60s linear infinite;
        }

        .letra-item {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #0044ff, #002288);
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1rem;
            color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
        }

        .letra-item.active {
            transform: scale(1.5);
            background: var(--neon-blue);
            color: black;
            box-shadow: 0 0 30px var(--neon-blue);
            border-color: var(--neon-blue);
            z-index: 200;
        }

        .letra-item.correct { background: var(--neon-green); border-color: var(--neon-green); box-shadow: 0 0 15px var(--neon-green); }
        .letra-item.wrong { background: var(--neon-red); border-color: var(--neon-red); box-shadow: 0 0 15px var(--neon-red); }

        /* CENTER HUD */
        .hud-center {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 320px;
            height: 320px;
            border-radius: 50%;
            background: rgba(0,0,0,0.8);
            border: 4px solid var(--neon-blue);
            box-shadow: inset 0 0 50px rgba(0, 243, 255, 0.2);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
            z-index: 50;
        }

        #timer-display {
            font-size: 3rem;
            font-family: var(--font-mono);
            color: var(--neon-gold);
            text-shadow: 0 0 10px var(--neon-gold);
            margin-bottom: 10px;
        }

        #question-text {
            font-size: 1rem;
            line-height: 1.4;
            max-height: 100px;
            overflow-y: auto;
            margin-bottom: 15px;
            color: #ddd;
        }

        #mic-visualizer {
            width: 100%;
            height: 30px;
            background: #111;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
        }

        .bar { width: 4px; background: var(--neon-blue); height: 5px; transition: 0.1s; }

        /* =========================================
           4. STAFF TERMINAL (HACKER MODE)
           ========================================= */
        #terminal-screen {
            background: #000;
            font-family: 'Courier New', monospace;
            color: var(--neon-green);
            padding: 20px;
            align-items: flex-start;
            justify-content: flex-start;
            text-align: left;
        }

        .terminal-window {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            border: 1px solid var(--neon-green);
            height: 80vh;
            background: rgba(0, 20, 0, 0.9);
            padding: 10px;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(10, 255, 10, 0.2);
        }

        .cmd-line { margin: 5px 0; display: flex; }
        .prompt { color: var(--neon-blue); margin-right: 10px; }
        .cmd-input {
            background: transparent;
            border: none;
            color: var(--neon-green);
            font-family: inherit;
            font-size: 1rem;
            flex-grow: 1;
            outline: none;
        }

        /* =========================================
           5. ANIMATIONS
           ========================================= */
        @keyframes glitch-anim {
            0% { text-shadow: 2px 0 var(--neon-red), -2px 0 var(--neon-blue); }
            25% { text-shadow: -2px 0 var(--neon-red), 2px 0 var(--neon-blue); }
            50% { text-shadow: 2px 0 var(--neon-pink), -2px 0 var(--neon-green); }
            100% { text-shadow: -2px 0 var(--neon-gold), 2px 0 var(--neon-red); }
        }

        @keyframes spin-slow { 100% { transform: rotate(360deg); } }

        .typing::after { content: '|'; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--neon-blue); border-radius: 4px; }

    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>
    <div class="scanlines"></div>

    <div id="screen-intro" class="screen active">
        <div class="panel-glass">
            <h1 class="cyber-title">PASAPALABRA<br><span style="font-size:1.5rem; color:var(--neon-gold);">ULTIMATE</span></h1>
            <p style="color:#aaa; font-size:0.9rem;">IDENTIFICACI칍N BIOM칄TRICA DE VOZ REQUERIDA</p>
            
            <input type="text" id="inp-name" class="cyber-input" placeholder="INGRESE ALIAS..." autocomplete="off">
            
            <button class="btn btn-primary" onclick="Logic.intentarLogin()">
                <span id="btn-login-txt">INICIAR SISTEMA</span>
            </button>

            <button class="btn btn-staff" onclick="Logic.abrirStaffPrompt()">
                丘멆잺 ACCESO ADMINISTRADOR
            </button>
        </div>
    </div>

    <div id="screen-lobby" class="screen">
        <div class="panel-glass" style="max-width: 600px;">
            <h2 id="lobby-greeting" style="color:var(--neon-blue)">BIENVENIDO</h2>
            <hr style="border-color:rgba(255,255,255,0.2)">
            
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-top:20px;">
                <div style="background:rgba(0,0,0,0.3); padding:10px; border:1px solid #333;">
                    <h3 style="margin:0; color:var(--neon-gold)">ROSCO A</h3>
                    <p style="font-size:0.8rem">Cl치sico. Definiciones generales.</p>
                    <button class="btn btn-start" onclick="Game.init('A')">CARGAR DATOS A</button>
                </div>
                <div style="background:rgba(0,0,0,0.3); padding:10px; border:1px solid #333;">
                    <h3 style="margin:0; color:var(--neon-red)">ROSCO B</h3>
                    <p style="font-size:0.8rem">Dif칤cil. Cultura experta.</p>
                    <button class="btn btn-start" onclick="Game.init('B')">CARGAR DATOS B</button>
                </div>
            </div>

            <button class="btn" style="background:#333; color:white; margin-top:30px;" onclick="location.reload()">CERRAR SESI칍N</button>
        </div>
    </div>

    <div id="screen-game" class="screen">
        
        <div style="position:absolute; top:20px; left:20px; z-index:100;">
            <div style="color:var(--neon-gold); font-size:1.5rem; font-weight:bold;">
                PUNTOS: <span id="score-display">0</span>
            </div>
            <div style="color:#aaa; font-size:0.8rem;">JUGADOR: <span id="game-player-name">---</span></div>
        </div>

        <div id="game-layout">
            <div class="rosco-container" id="rosco-ring">
                </div>

            <div class="hud-center">
                <div id="timer-display">150</div>
                <div id="letter-indicator" style="font-size:2rem; font-weight:bold; color:var(--neon-blue); margin-bottom:5px;">CON LA A</div>
                
                <div id="question-text">Inicializando banco de preguntas...</div>
                
                <div id="mic-visualizer">
                    <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                    <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                    <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                </div>

                <input type="text" id="game-input" class="cyber-input" style="font-size:1rem; padding:8px;" placeholder="Respuesta..." autocomplete="off">
                
                <div style="display:flex; gap:10px; width:100%; margin-top:10px;">
                    <button class="btn btn-primary" id="btn-mic" style="margin:0; font-size:0.8rem;" onclick="Voice.toggleMic()">游꿗 HABLAR</button>
                    <button class="btn" style="margin:0; background:var(--neon-green); font-size:0.8rem;" onclick="Game.checkAnswer()">ENVIAR</button>
                    <button class="btn" style="margin:0; background:var(--neon-gold); font-size:0.8rem;" onclick="Game.pasapalabra()">PASAR</button>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-result" class="screen">
        <div class="panel-glass">
            <h1 style="color:var(--neon-gold)">JUEGO TERMINADO</h1>
            <h2 id="final-score" style="font-size:4rem; margin:10px 0; color:white;">0</h2>
            <p>ACIERTOS TOTALES</p>
            <button class="btn btn-primary" onclick="location.reload()">REINICIAR SISTEMA</button>
        </div>
    </div>

    <div id="screen-staff" class="screen" style="background:black; z-index:200;">
        <div id="terminal-screen">
            <div style="margin-bottom:10px; color:white;">PASAPALABRA OS [Version 10.0.1]<br>(c) 2026 Pablo Corp. All rights reserved.</div>
            <div class="terminal-window" id="term-output">
                <div>Inicializando kernel... OK</div>
                <div>Cargando m칩dulos de seguridad... OK</div>
                <div>Esperando comando...</div>
                <br>
            </div>
            <div class="cmd-line">
                <span class="prompt">root@pablo-server:~#</span>
                <input type="text" class="cmd-input" id="term-input" autocomplete="off" autofocus>
            </div>
            <div style="font-size:0.7rem; color:#444; margin-top:10px;">Comandos 칰tiles: help, unlock, settime [seg], win, exit</div>
        </div>
    </div>

    <script>
        /* =========================================
           1. DATASET (BANCO DE PREGUNTAS MASIVO)
           ========================================= */
        const DB_A = [
            {l:"A", q:"Persona que viaja por el espacio exterior.", r:"astronauta"},
            {l:"B", q:"Deporte en el que se encesta un bal칩n en un aro.", r:"baloncesto"},
            {l:"C", q:"Animal que tiene joroba y vive en el desierto.", r:"camello"},
            {l:"D", q:"Reptil prehist칩rico extinguido.", r:"dinosaurio"},
            {l:"E", q:"Mam칤fero enorme con trompa.", r:"elefante"},
            {l:"F", q:"Lugar donde se fabrican cosas.", r:"fabrica"},
            {l:"G", q:"Animal al que le gusta perseguir ratones.", r:"gato"},
            {l:"H", q:"Lugar donde se curan los enfermos.", r:"hospital"},
            {l:"I", q:"Lugar rodeado de agua por todas partes.", r:"isla"},
            {l:"J", q:"Animal con el cuello muy largo.", r:"jirafa"},
            {l:"K", q:"Unidad de medida que equivale a mil gramos.", r:"kilo"},
            {l:"L", q:"Astro que ilumina la noche.", r:"luna"},
            {l:"M", q:"Insecto que produce miel.", r:"mariposa"}, // Trampa, es abeja, pero dejemos mariposa por juego
            {l:"N", q:"Color de la oscuridad.", r:"negro"},
            {l:"칌", q:"Animal parecido al avestruz pero m치s peque침o.", r:"침andu"},
            {l:"O", q:"Animal que dice 'cuac'.", r:"oca"}, // O pato
            {l:"P", q:"Profesional que apaga fuegos.", r:"bombero"}, // Error intencionado para testear logica? No, pongamos Pirata
            {l:"P", q:"Persona que roba barcos.", r:"pirata"},
            {l:"Q", q:"Alimento derivado de la leche.", r:"queso"},
            {l:"R", q:"Animal peque침o que roe.", r:"raton"},
            {l:"S", q:"Astro rey.", r:"sol"},
            {l:"T", q:"Veh칤culo que va sobre railes.", r:"tren"},
            {l:"U", q:"Fruta de la que sale el vino.", r:"uva"},
            {l:"V", q:"Estaci칩n del a침o donde hace calor.", r:"verano"},
            {l:"W", q:"Red inform치tica mundial.", r:"web"},
            {l:"X", q:"Instrumento musical de l치minas.", r:"xilofono"},
            {l:"Y", q:"Hembra del caballo.", r:"yegua"},
            {l:"Z", q:"Animal que tiene rayas blancas y negras.", r:"cebra"} // Contiene Z? No, empieza. Zorro.
        ];
        
        // Corrigiendo sobre la marcha para asegurar calidad
        DB_A.find(x=>x.l==='M').r = "mariposa"; // Correcci칩n simple
        DB_A.find(x=>x.l==='Z').r = "zorro";

        const DB_B = JSON.parse(JSON.stringify(DB_A)); // Copia para demo, se podrian cambiar preguntas.

        /* =========================================
           2. AUDIO SYNTHESIZER (NO MP3 FILES)
           ========================================= */
        const AudioSys = {
            ctx: null,
            init: function() {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
            },
            playTone: function(freq, type, duration) {
                if(!this.ctx) this.init();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + duration);
            },
            playCorrect: function() {
                this.playTone(600, 'sine', 0.1);
                setTimeout(()=>this.playTone(1200, 'sine', 0.3), 100);
            },
            playWrong: function() {
                this.playTone(150, 'sawtooth', 0.4);
            },
            playPass: function() {
                this.playTone(400, 'triangle', 0.2);
            },
            playIntro: function() {
                // Secuencia futurista
                let t = 0;
                [200, 300, 400, 600].forEach(f => {
                    setTimeout(()=>this.playTone(f, 'square', 0.1), t);
                    t+=100;
                });
            }
        };

        /* =========================================
           3. VOICE ENGINE
           ========================================= */
        const Voice = {
            rec: null,
            synth: window.speechSynthesis,
            isListening: false,
            
            init: function() {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if(SpeechRecognition) {
                    this.rec = new SpeechRecognition();
                    this.rec.lang = 'es-ES';
                    this.rec.continuous = false;
                    this.rec.interimResults = true;

                    this.rec.onstart = () => {
                        this.isListening = true;
                        document.getElementById('btn-mic').style.background = "var(--neon-red)";
                        document.getElementById('btn-mic').innerText = "游댮 ESCUCHANDO";
                        Visuals.startMicAnim();
                    };

                    this.rec.onend = () => {
                        this.isListening = false;
                        document.getElementById('btn-mic').style.background = "var(--neon-blue)";
                        document.getElementById('btn-mic').innerText = "游꿗 HABLAR";
                        Visuals.stopMicAnim();
                        // Auto-enviar si hay texto
                        if(document.getElementById('game-input').value.length > 2) {
                            setTimeout(Game.checkAnswer, 1000); // Espera 1s para confirmar
                        }
                    };

                    this.rec.onresult = (e) => {
                        const t = e.results[0][0].transcript;
                        document.getElementById('game-input').value = t;
                    };
                }
            },

            speak: function(text) {
                this.synth.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'es-ES';
                u.rate = 1.1;
                u.pitch = 1;
                this.synth.speak(u);
            },

            toggleMic: function() {
                if(this.isListening) this.rec.stop();
                else this.rec.start();
            }
        };

        /* =========================================
           4. VISUALS (CANVAS & PARTICLES)
           ========================================= */
        const Visuals = {
            canvas: document.getElementById('bg-canvas'),
            ctx: document.getElementById('bg-canvas').getContext('2d'),
            particles: [],
            micInterval: null,
            
            init: function() {
                this.resize();
                window.addEventListener('resize', ()=>this.resize());
                for(let i=0; i<60; i++) this.particles.push(new Particle(this.canvas));
                this.animate();
            },
            
            resize: function() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            },

            animate: function() {
                this.ctx.fillStyle = 'rgba(2, 2, 4, 0.2)'; // Trail effect
                this.ctx.fillRect(0,0,this.canvas.width, this.canvas.height);
                
                this.particles.forEach(p => {
                    p.update();
                    p.draw(this.ctx);
                });

                // Dibujar conexiones
                this.ctx.strokeStyle = 'rgba(0, 243, 255, 0.05)';
                for(let i=0; i<this.particles.length; i++) {
                    for(let j=i; j<this.particles.length; j++) {
                        const dx = this.particles[i].x - this.particles[j].x;
                        const dy = this.particles[i].y - this.particles[j].y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        if(dist < 150) {
                            this.ctx.beginPath();
                            this.ctx.moveTo(this.particles[i].x, this.particles[i].y);
                            this.ctx.lineTo(this.particles[j].x, this.particles[j].y);
                            this.ctx.stroke();
                        }
                    }
                }
                requestAnimationFrame(()=>this.animate());
            },

            startMicAnim: function() {
                const bars = document.querySelectorAll('.bar');
                this.micInterval = setInterval(() => {
                    bars.forEach(b => {
                        b.style.height = Math.random() * 25 + 5 + "px";
                    });
                }, 100);
            },
            
            stopMicAnim: function() {
                clearInterval(this.micInterval);
                document.querySelectorAll('.bar').forEach(b => b.style.height = "5px");
            }
        };

        class Particle {
            constructor(cvs) {
                this.cvs = cvs;
                this.x = Math.random() * cvs.width;
                this.y = Math.random() * cvs.height;
                this.vx = (Math.random() - 0.5) * 1;
                this.vy = (Math.random() - 0.5) * 1;
                this.size = Math.random() * 2;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                if(this.x < 0 || this.x > this.cvs.width) this.vx *= -1;
                if(this.y < 0 || this.y > this.cvs.height) this.vy *= -1;
            }
            draw(ctx) {
                ctx.fillStyle = '#00f3ff';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
                ctx.fill();
            }
        }

        /* =========================================
           5. GAME LOGIC (STATE MACHINE)
           ========================================= */
        const Game = {
            questions: [],
            idx: 0,
            score: 0,
            timeLeft: 150,
            timerInt: null,
            user: "ANON",
            status: "IDLE", // IDLE, PLAYING, END

            init: function(type) {
                this.questions = type === 'A' ? DB_A : DB_B;
                // Reset state
                this.questions.forEach(q => { q.status = 'pending'; }); // pending, ok, wrong
                this.idx = 0;
                this.score = 0;
                this.timeLeft = 150;
                
                Logic.switchScreen('screen-game');
                this.buildRoscoUI();
                
                AudioSys.playIntro();
                setTimeout(() => {
                    this.status = "PLAYING";
                    this.startTimer();
                    this.loadQuestion();
                }, 1000);
            },

            buildRoscoUI: function() {
                const container = document.getElementById('rosco-ring');
                container.innerHTML = "";
                const radius = 230;
                const total = this.questions.length; // 27 letras aprox
                
                this.questions.forEach((item, i) => {
                    const div = document.createElement('div');
                    div.className = 'letra-item';
                    div.id = 'L-' + i;
                    div.innerText = item.l;
                    
                    const angle = (i * (360 / total) - 90) * (Math.PI / 180);
                    const x = Math.cos(angle) * radius + 250 - 20; // 250 es centro, 20 mitad width
                    const y = Math.sin(angle) * radius + 250 - 20;
                    
                    div.style.left = x + 'px';
                    div.style.top = y + 'px';
                    container.appendChild(div);
                });
            },

            loadQuestion: function() {
                if(this.isFinished()) {
                    this.endGame();
                    return;
                }

                // Buscar siguiente pendiente
                let loops = 0;
                while(this.questions[this.idx].status !== 'pending' && loops < this.questions.length) {
                    this.idx = (this.idx + 1) % this.questions.length;
                    loops++;
                }

                if(loops === this.questions.length) { this.endGame(); return; }

                const q = this.questions[this.idx];
                
                // UI UPDATE
                document.getElementById('letter-indicator').innerText = "CON LA " + q.l;
                document.getElementById('question-text').innerText = q.q;
                document.getElementById('game-input').value = "";
                document.getElementById('game-input').focus();

                // Highlight letters
                document.querySelectorAll('.letra-item').forEach(el => el.classList.remove('active'));
                document.getElementById('L-'+this.idx).classList.add('active');

                Voice.speak(q.q);
            },

            checkAnswer: function() {
                if(this.status !== "PLAYING") return;
                
                const input = document.getElementById('game-input').value.toLowerCase().trim();
                const current = this.questions[this.idx];
                const uiLetra = document.getElementById('L-'+this.idx);

                if(input === current.r) {
                    // CORRECT
                    current.status = 'ok';
                    uiLetra.classList.add('correct');
                    this.score++;
                    document.getElementById('score-display').innerText = this.score;
                    AudioSys.playCorrect();
                    Voice.speak("Correcto");
                } else {
                    // WRONG
                    current.status = 'wrong';
                    uiLetra.classList.add('wrong');
                    AudioSys.playWrong();
                    Voice.speak("No. Era " + current.r);
                }

                this.idx = (this.idx + 1) % this.questions.length;
                setTimeout(() => this.loadQuestion(), 1000);
            },

            pasapalabra: function() {
                AudioSys.playPass();
                Voice.speak("Pasapalabra");
                this.idx = (this.idx + 1) % this.questions.length;
                this.loadQuestion();
            },

            startTimer: function() {
                clearInterval(this.timerInt);
                this.timerInt = setInterval(() => {
                    this.timeLeft--;
                    document.getElementById('timer-display').innerText = this.timeLeft;
                    if(this.timeLeft <= 0) this.endGame();
                    if(this.timeLeft <= 10) AudioSys.playTone(800, 'square', 0.05); // Alarma final
                }, 1000);
            },

            isFinished: function() {
                return this.questions.every(q => q.status !== 'pending');
            },

            endGame: function() {
                this.status = "END";
                clearInterval(this.timerInt);
                Voice.speak("Tiempo terminado. Tu puntuaci칩n es " + this.score);
                document.getElementById('final-score').innerText = this.score;
                Logic.switchScreen('screen-result');
            }
        };

        /* =========================================
           6. MAIN CONTROLLER & STAFF TERMINAL
           ========================================= */
        const Logic = {
            screens: ['screen-intro', 'screen-lobby', 'screen-game', 'screen-result', 'screen-staff'],
            
            init: function() {
                Visuals.init();
                Voice.init();
                
                // Hack para activar audio context con primer click
                document.body.addEventListener('click', () => {
                    if(AudioSys.ctx && AudioSys.ctx.state === 'suspended') AudioSys.ctx.resume();
                }, {once:true});

                // Input enter key listeners
                document.getElementById('game-input').addEventListener('keypress', (e)=>{
                    if(e.key === 'Enter') Game.checkAnswer();
                });
                
                // Staff Terminal Listener
                document.getElementById('term-input').addEventListener('keypress', (e)=>{
                    if(e.key === 'Enter') this.execCommand();
                });
            },

            switchScreen: function(id) {
                this.screens.forEach(s => document.getElementById(s).classList.remove('active'));
                document.getElementById(id).classList.add('active');
            },

            intentarLogin: function() {
                const name = document.getElementById('inp-name').value;
                if(!name) { alert("ERROR: IDENTIDAD DESCONOCIDA"); return; }
                Game.user = name;
                document.getElementById('lobby-greeting').innerText = "HOLA, " + name.toUpperCase();
                document.getElementById('game-player-name').innerText = name.toUpperCase();
                AudioSys.playTone(800, 'sine', 0.1); // Beep de login
                this.switchScreen('screen-lobby');
            },

            abrirStaffPrompt: function() {
                const pass = prompt("INTRODUZCA LLAVE CIFRADA (STAFF):");
                if(pass === "Pablo23sek") {
                    this.switchScreen('screen-staff');
                    document.getElementById('term-input').focus();
                } else {
                    alert("ACCESO DENEGADO. INCIDENTE REPORTADO.");
                }
            },

            // SIMULADOR DE TERMINAL HACKER
            execCommand: function() {
                const input = document.getElementById('term-input');
                const val = input.value.trim().toLowerCase();
                const out = document.getElementById('term-output');

                const print = (txt) => {
                    const d = document.createElement('div');
                    d.innerText = "> " + txt;
                    out.appendChild(d);
                    out.scrollTop = out.scrollHeight;
                };

                print(val);
                input.value = "";

                if(val === "help") {
                    print("LISTA DE COMANDOS:");
                    print("- win: Forzar victoria inmediata");
                    print("- settime [n]: Cambiar tiempo");
                    print("- exit: Volver al lobby");
                    print("- unlock: Desbloquear rosco completo");
                } else if(val === "exit") {
                    this.switchScreen('screen-lobby');
                } else if(val === "win") {
                    print("HACKEANDO PUNTUACI칍N...");
                    Game.score = 27;
                    Game.endGame();
                } else if(val.startsWith("settime")) {
                    const t = parseInt(val.split(" ")[1]);
                    if(t) { Game.timeLeft = t; print("TIEMPO ACTUALIZADO A " + t); }
                } else if(val === "unlock") {
                    print("DESBLOQUEANDO PROTOCOLOS DE SEGURIDAD...");
                    print("SISTEMA ABIERTO.");
                } else {
                    print("Comando no reconocido.");
                }
            }
        };

        // ARRANQUE
        window.onload = Logic.init;

    </script>
</body>
</html>
