<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Pasapalabra IA - Validado</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #050510; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        #origen-indicador { position: absolute; top: 15px; right: 15px; padding: 6px 18px; border-radius: 20px; font-size: 0.85em; font-weight: bold; background: #16213e; border: 1px solid #00f2ff; color: #00f2ff; }
        #rosco-container { position: relative; width: 450px; height: 450px; margin: 40px auto; }
        .letra { position: absolute; width: 35px; height: 35px; background: #0044cc; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid #fff; transition: 0.3s; transform: translate(-50%, -50%); }
        .acierto { background: #2ecc71 !important; box-shadow: 0 0 15px #2ecc71; }
        .fallo { background: #e74c3c !important; box-shadow: 0 0 15px #e74c3c; }
        .activa { border: 4px solid #f1c40f !important; scale: 1.3; z-index: 10; box-shadow: 0 0 20px #f1c40f; }
        #panel { background: #16213e; padding: 30px; border-radius: 20px; width: 90%; max-width: 550px; text-align: center; border: 1px solid #1f4068; }
        input { padding: 12px; width: 80%; border-radius: 8px; font-size: 18px; margin: 15px 0; text-align: center; }
        button { padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 5px; border: none; }
        .btn-enviar { background: #2ecc71; color: white; }
        .btn-paso { background: #f1c40f; color: #000; }
        #pregunta { font-size: 1.2em; min-height: 80px; margin: 20px 0; }
    </style>
</head>
<body>
    <div id="origen-indicador">ðŸ¤– IA VALIDADA</div>
    <h1>PASAPALABRA PRO</h1>
    <div id="rosco-container"></div>
    <div id="panel">
        <div id="pregunta">Cargando...</div>
        <input type="text" id="respuesta" placeholder="Escribe aquÃ­..." autocomplete="off">
        <br>
        <button class="btn-enviar" onclick="validar()">ENVIAR</button>
        <button class="btn-paso" onclick="pasapalabra()">PASAPALABRA</button>
    </div>

    <script>
        const respaldo = [
            {letra: 'H', pregunta: 'Animal con trompa que vive en la selva.', respuesta: 'elefante', tipo: 'CONTIENE LA'},
            {letra: 'K', pregunta: 'Fruta de piel vellosa y color verde.', respuesta: 'kiwi', tipo: 'CON LA'}
        ];

        let roscoData = [];
        let currentIndex = 0;

        async function init() {
            try {
                const res = await fetch('preguntas.json?t=' + Date.now());
                const dataIA = await res.json();
                
                const letras = "ABCDEFGHIJLMNOPQRSTUVXYZ".split('');
                roscoData = letras.map(l => {
                    // Busca en la IA, si no estÃ¡ o estÃ¡ mal, busca en respaldo
                    return dataIA.find(p => p.letra === l) || 
                           respaldo.find(p => p.letra === l) || 
                           {letra: l, pregunta: "Pregunta en mantenimiento...", respuesta: "error", tipo: "CON LA"};
                }).map(p => ({...p, estado: 'pendiente'}));

                renderRosco();
                updateUI();
            } catch (e) {
                document.getElementById('pregunta').innerText = "Error cargando datos.";
            }
        }

        function renderRosco() {
            const container = document.getElementById('rosco-container');
            container.innerHTML = "";
            roscoData.forEach((p, i) => {
                const angle = (i * (360 / roscoData.length)) - 90;
                const x = 225 + 185 * Math.cos(angle * Math.PI / 180);
                const y = 225 + 185 * Math.sin(angle * Math.PI / 180);
                const div = document.createElement('div');
                div.id = `l-${i}`;
                div.className = 'letra';
                div.style.left = `${x}px`;
                div.style.top = `${y}px`;
                div.innerText = p.letra;
                container.appendChild(div);
            });
        }

        function updateUI() {
            if (roscoData.every(p => p.estado !== 'pendiente')) {
                const aciertos = roscoData.filter(p => p.estado === 'acierto').length;
                document.getElementById('panel').innerHTML = `<h2>FIN: ${aciertos} ACIERTOS</h2><button onclick="location.reload()">NUEVA PARTIDA</button>`;
                return;
            }
            while (roscoData[currentIndex].estado !== 'pendiente') {
                currentIndex = (currentIndex + 1) % roscoData.length;
            }
            document.querySelectorAll('.letra').forEach(l => l.classList.remove('activa'));
            document.getElementById(`l-${currentIndex}`).classList.add('activa');
            const p = roscoData[currentIndex];
            document.getElementById('pregunta').innerText = `${p.tipo} la ${p.letra}: ${p.pregunta}`;
        }

        function validar() {
            const userRes = document.getElementById('respuesta').value.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            const correcta = roscoData[currentIndex].respuesta.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            const el = document.getElementById(`l-${currentIndex}`);
            
            if (userRes === correcta) {
                roscoData[currentIndex].estado = 'acierto';
                el.classList.add('acierto');
            } else {
                roscoData[currentIndex].estado = 'fallo';
                el.classList.add('fallo');
            }
            document.getElementById('respuesta').value = "";
            currentIndex = (currentIndex + 1) % roscoData.length;
            updateUI();
        }

        function pasapalabra() {
            currentIndex = (currentIndex + 1) % roscoData.length;
            updateUI();
        }

        document.getElementById('respuesta').addEventListener('keypress', (e) => { if(e.key === 'Enter') validar(); });
        init();
    </script>
</body>
</html>
