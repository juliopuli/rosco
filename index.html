<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Pasapalabra Profesional</title>
    <style>
        :root { --azul-oscuro: #050a1f; --panel: #111b3d; --oro: #ffcc00; --verde: #2ecc71; --rojo: #dc3545; }
        body { background: var(--azul-oscuro); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .oculto { display: none !important; }

        /* --- PANTALLAS --- */
        .pantalla { text-align: center; background: var(--panel); padding: 40px; border-radius: 20px; border: 1px solid #2a3a6d; width: 400px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        input { width: 80%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; font-size: 1rem; text-align: center; }
        .btn { width: 100%; padding: 15px; margin: 10px 0; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .btn-green { background: var(--verde); color: white; }
        .btn-blue { background: #3498db; color: white; }

        /* --- LAYOUT JUEGO --- */
        #juego { display: none; width: 100vw; height: 100vh; position: relative; }
        .bloque-jugador { position: absolute; transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; align-items: center; justify-content: center; }

        /* Estado Activo (Grande) */
        .activo { width: 600px; height: 600px; top: 50%; left: 50%; transform: translate(-50%, -55%); z-index: 10; background: rgba(17, 27, 61, 0.9); border-radius: 30px; border: 2px solid var(--oro); }
        /* Estado Pequeño (Esquina) */
        .peque { width: 200px; height: 200px; top: 20px; right: 20px; z-index: 5; opacity: 0.7; transform: scale(0.8); border: 1px solid #555; border-radius: 20px; }

        /* --- EL ROSCO (CORREGIDO) --- */
        .rosco { position: relative; width: 400px; height: 400px; transition: 0.8s; }
        .peque .rosco { width: 140px; height: 140px; }
        
        .letra { 
            position: absolute; width: 40px; height: 40px; background: #0044ff; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 18px; border: 2px solid white; transition: 0.3s;
        }
        .peque .letra { width: 12px; height: 12px; font-size: 0; border-width: 1px; }

        .letra.actual { background: var(--oro); color: black; transform: scale(1.2); box-shadow: 0 0 15px var(--oro); }
        .letra.bien { background: var(--verde); }
        .letra.mal { background: var(--rojo); }

        /* --- CONTROLES --- */
        .controles { width: 90%; text-align: center; margin-top: 20px; }
        .peque .controles { display: none; }
        .pregunta { font-size: 1.2rem; min-height: 60px; margin-bottom: 10px; }
        .botones-juego { display: flex; gap: 10px; }
    </style>
</head>
<body>

    <div id="p-nombre" class="pantalla">
        <h1 style="color:var(--oro)">PASAPALABRA</h1>
        <input type="text" id="nombre-input" placeholder="Escribe tu nombre">
        <button class="btn btn-green" onclick="guardarNombre()">ENTRAR</button>
    </div>

    <div id="p-menu" class="pantalla oculto">
        <h2 id="saludo"></h2>
        <button class="btn btn-blue" onclick="crearSala()">CREAR SALA ONLINE</button>
        <input type="text" id="join-codigo" placeholder="Código de sala">
        <button class="btn btn-green" onclick="unirseSala()">UNIRSE A SALA</button>
    </div>

    <div id="p-lobby" class="pantalla oculto">
        <h2>SALA: <span id="display-cod" style="color:var(--oro)">------</span></h2>
        <div id="lista-nombres" style="margin:20px 0; text-align:left; background:rgba(0,0,0,0.2); padding:15px; border-radius:10px;">
            <div id="lobby-j1">1. Esperando...</div>
            <div id="lobby-j2">2. Esperando...</div>
        </div>
        <button id="btn-comenzar" class="btn btn-green oculto" onclick="hostEmpezar()">EMPEZAR PARTIDA</button>
        <p id="wait-msg" class="oculto">Esperando al anfitrión...</p>
    </div>

    <div id="juego">
        <div id="jugador1" class="bloque-jugador activo">
            <h3 id="name1">PEPE</h3>
            <div id="rosco1" class="rosco"></div>
            <div class="controles">
                <div id="preg1" class="pregunta">Cargando...</div>
                <input type="text" id="resp1" placeholder="Tu respuesta...">
                <div class="botones-juego">
                    <button class="btn btn-green" onclick="enviar(1)">ENVIAR</button>
                    <button class="btn" style="background:var(--oro)" onclick="pasar(1)">PASO</button>
                </div>
            </div>
        </div>

        <div id="jugador2" class="bloque-jugador peque">
            <h3 id="name2" style="font-size:0.8rem">RIVAL</h3>
            <div id="rosco2" class="rosco"></div>
            <div class="controles">
                <div id="preg2" class="pregunta">Cargando...</div>
                <input type="text" id="resp2" placeholder="Tu respuesta...">
                <div class="botones-juego">
                    <button class="btn btn-green" onclick="enviar(2)">ENVIAR</button>
                    <button class="btn" style="background:var(--oro)" onclick="pasar(2)">PASO</button>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- DATOS (Imagen subida) ---
    const letrasArr = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ".split("");
    const bancoA = [
        {l:"A", p:"Relativo a las abejas", r:"apícola"},
        {l:"B", p:"Mide dirección viento", r:"veleta"}, // Según tu imagen la B es veleta
        {l:"C", p:"Vehículo grande mercancías", r:"camión"},
        {l:"D", p:"Animal marino inteligente", r:"delfín"},
        {l:"E", p:"Lugar cría elefantes", r:"elefantería"},
        {l:"F", p:"Luz guía barcos", r:"faro"},
        {l:"G", p:"Ave corral pone huevos", r:"gallina"},
        {l:"H", p:"Agua sólida por frío", r:"hielo"},
        {l:"I", p:"Porción tierra rodeada agua", r:"isla"},
        {l:"J", p:"Animal cuello muy largo", r:"jirafa"},
        {l:"L", p:"Líquido blanco vacas", r:"leche"},
        {l:"M", p:"Fruta del manzano", r:"manzana"},
        {l:"N", p:"Fruta cítrica naranja", r:"naranja"},
        {l:"Ñ", p:"Persona tiene pocos años", r:"niño"},
        {l:"O", p:"Animal que da lana", r:"oveja"},
        {l:"P", p:"Instrumento teclas", r:"piano"},
        {l:"Q", p:"Alimento leche cuajada", r:"queso"},
        {l:"R", p:"Mamífero roedor pequeño", r:"ratón"},
        {l:"S", p:"Cuerpo celeste luz y calor", r:"sol"},
        {l:"T", p:"Aparato hablar distancia", r:"teléfono"},
        {l:"U", p:"Fruta del vino", r:"uva"},
        {l:"V", p:"Persona vive mismo edificio", r:"vecino"},
        {l:"X", p:"Examen tejido vivo", r:"biopsia"},
        {l:"Y", p:"Embarcación lujo", r:"yate"},
        {l:"Z", p:"Calzado cubre pie", r:"zapato"}
    ];
    // Se usa el mismo banco para simplificar, pero el sistema está listo para dos
    const bancoB = [...bancoA]; 

    let miNombre = "";
    let miRol = ""; 
    let salaID = "";
    let turnoActual = 1;
    let datosJuego = { j1: { pos: 0, res: [] }, j2: { pos: 0, res: [] } };

    function guardarNombre() {
        miNombre = document.getElementById('nombre-input').value;
        if(!miNombre) return;
        document.getElementById('saludo').innerText = "HOLA, " + miNombre.toUpperCase();
        mostrar('p-menu');
    }

    function crearSala() {
        miRol = "host";
        salaID = Math.floor(100000 + Math.random() * 900000);
        document.getElementById('display-cod').innerText = salaID;
        document.getElementById('lobby-j1').innerText = "1. " + miNombre + " (TÚ)";
        
        localStorage.setItem('sala_' + salaID, JSON.stringify({host: miNombre, guest: null, status: 'esperando'}));
        mostrar('p-lobby');
        window.addEventListener('storage', monitorizarSala);
    }

    function unirseSala() {
        miRol = "guest";
        salaID = document.getElementById('join-codigo').value;
        let data = JSON.parse(localStorage.getItem('sala_' + salaID));
        if(!data) return alert("Sala no existe");

        data.guest = miNombre;
        localStorage.setItem('sala_' + salaID, JSON.stringify(data));
        
        document.getElementById('display-cod').innerText = salaID;
        document.getElementById('lobby-j1').innerText = "1. " + data.host;
        document.getElementById('lobby-j2').innerText = "2. " + miNombre + " (TÚ)";
        document.getElementById('wait-msg').classList.remove('oculto');
        mostrar('p-lobby');
        window.addEventListener('storage', monitorizarSala);
    }

    function monitorizarSala(e) {
        if(e.key !== 'sala_' + salaID) return;
        let data = JSON.parse(e.newValue);
        
        if(miRol === 'host' && data.guest) {
            document.getElementById('lobby-j2').innerText = "2. " + data.guest;
            document.getElementById('btn-comenzar').classList.remove('oculto');
        }
        if(data.status === 'jugando') empezarPartidaUI(data);
        if(data.status === 'actualizar') sincronizarJuego(data);
    }

    function hostEmpezar() {
        let data = JSON.parse(localStorage.getItem('sala_' + salaID));
        data.status = 'jugando';
        data.turno = 1;
        data.j1 = { pos: 0, res: Array(25).fill(0) };
        data.j2 = { pos: 0, res: Array(25).fill(0) };
        localStorage.setItem('sala_' + salaID, JSON.stringify(data));
        empezarPartidaUI(data);
    }

    function empezarPartidaUI(data) {
        mostrar('juego');
        document.getElementById('juego').style.display = 'block';
        document.getElementById('name1').innerText = data.host;
        document.getElementById('name2').innerText = data.guest;
        crearRoscoVisual('rosco1');
        crearRoscoVisual('rosco2');
        sincronizarJuego(data);
    }

    function crearRoscoVisual(id) {
        const contenedor = document.getElementById(id);
        contenedor.innerHTML = "";
        const total = 25;
        const radio = 160; 

        letrasArr.forEach((letra, i) => {
            const div = document.createElement('div');
            div.className = 'letra';
            div.id = id + '-' + i;
            div.innerText = letra;

            // MATEMÁTICAS DEL CÍRCULO (Aquí estaba el fallo de tu foto)
            const angulo = (i * 360 / total) - 90;
            const x = radio * Math.cos(angulo * Math.PI / 180);
            const y = radio * Math.sin(angulo * Math.PI / 180);

            div.style.left = `calc(50% + ${x}px - 20px)`;
            div.style.top = `calc(50% + ${y}px - 20px)`;
            contenedor.appendChild(div);
        });
    }

    function sincronizarJuego(data) {
        turnoActual = data.turno;
        datosJuego.j1 = data.j1;
        datosJuego.j2 = data.j2;

        // Visual de turnos
        const b1 = document.getElementById('jugador1');
        const b2 = document.getElementById('jugador2');
        
        if(turnoActual === 1) {
            b1.className = "bloque-jugador activo";
            b2.className = "bloque-jugador peque";
            actualizarPregunta(1);
        } else {
            b1.className = "bloque-jugador peque";
            b2.className = "bloque-jugador activo";
            actualizarPregunta(2);
        }

        actualizarColores(1, data.j1);
        actualizarColores(2, data.j2);

        // Bloqueo de inputs si no es tu turno
        document.getElementById('resp1').disabled = (miRol === 'guest' || turnoActual !== 1);
        document.getElementById('resp2').disabled = (miRol === 'host' || turnoActual !== 2);
    }

    function actualizarColores(num, player) {
        player.res.forEach((estado, i) => {
            const el = document.getElementById(`rosco${num}-${i}`);
            el.classList.remove('bien', 'mal', 'actual');
            if(estado === 1) el.classList.add('bien');
            if(estado === 2) el.classList.add('mal');
            if(i === player.pos) el.classList.add('actual');
        });
    }

    function actualizarPregunta(num) {
        const player = (num === 1) ? datosJuego.j1 : datosJuego.j2;
        const pData = bancoA[player.pos];
        document.getElementById('preg'+num).innerText = `CON LA ${pData.l}: ${pData.p}`;
    }

    function enviar(num) {
        const input = document.getElementById('resp'+num);
        const resp = input.value.toLowerCase().trim();
        const player = (num === 1) ? datosJuego.j1 : datosJuego.j2;
        
        if(resp === bancoA[player.pos].r) {
            player.res[player.pos] = 1;
        } else {
            player.res[player.pos] = 2;
            turnoActual = (num === 1) ? 2 : 1;
        }
        
        subirCambios(player, num);
        input.value = "";
    }

    function pasar(num) {
        const player = (num === 1) ? datosJuego.j1 : datosJuego.j2;
        turnoActual = (num === 1) ? 2 : 1;
        subirCambios(player, num);
    }

    function subirCambios(player, num) {
        player.pos = (player.pos + 1) % 25;
        let data = JSON.parse(localStorage.getItem('sala_' + salaID));
        data.status = 'actualizar';
        data.turno = turnoActual;
        if(num === 1) data.j1 = player; else data.j2 = player;
        localStorage.setItem('sala_' + salaID, JSON.stringify(data));
        sincronizarJuego(data);
    }

    function mostrar(id) {
        document.querySelectorAll('.pantalla').forEach(p => p.classList.add('oculto'));
        document.getElementById(id).classList.remove('oculto');
    }
</script>
</body>
</html>
