<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Pasapalabra Multiplayer Lobby</title>
    <style>
        body { 
            background-color: #050a1f; color: white; font-family: 'Segoe UI', sans-serif; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            min-height: 100vh; margin: 0; overflow: hidden;
        }

        /* --- UI GENERAL --- */
        .pantalla { 
            text-align: center; background: #111b3d; padding: 30px; 
            border-radius: 20px; border: 1px solid #2a3a6d; width: 400px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.6); position: relative;
        }
        .oculto { display: none !important; }
        
        .titulo { color: #ffcc00; font-size: 2.5rem; text-shadow: 0 0 10px #ffcc00; margin-bottom: 20px; }
        .subtitulo { color: #3498db; margin-bottom: 20px; font-size: 1.2rem; }

        input { 
            width: 80%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; 
            text-align: center; font-size: 1.1rem; background: #fff; color: #000;
        }

        .btn { 
            display: block; width: 100%; padding: 15px; margin: 10px 0; 
            border-radius: 50px; border: none; font-weight: bold; cursor: pointer; 
            font-size: 1rem; text-transform: uppercase; transition: 0.2s;
        }
        .btn-green { background: #2ecc71; color: white; }
        .btn-blue { background: #3498db; color: white; }
        .btn-disabled { background: #555; color: #888; cursor: not-allowed; }

        /* --- LOBBY ESPECÍFICO --- */
        .lista-jugadores {
            background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;
            margin: 20px 0; text-align: left;
        }
        .jugador-item { padding: 10px; border-bottom: 1px solid #2a3a6d; font-size: 1.1rem; }
        .jugador-item:last-child { border-bottom: none; }
        .esperando-text { font-style: italic; color: #888; animation: parpadeo 1.5s infinite; }
        
        @keyframes parpadeo { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* --- JUEGO (Visor) --- */
        #juego { display: none; width: 100%; height: 100vh; position: relative; }
        
        /* Contenedores de Rosco (Igual que antes) */
        .contenedor-jugador {
            position: absolute; transition: all 0.8s ease;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .turno-activo { 
            width: 100%; height: 100%; top: 0; left: 0; z-index: 10; 
            background: rgba(5, 10, 31, 0.95);
        }
        .turno-inactivo { 
            width: 150px; height: 150px; top: 20px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.8); border-radius: 50%; border: 2px solid #555;
            transform: scale(0.6);
        }
        
        .rosco-visual { position: relative; width: 340px; height: 340px; margin-top: 50px; }
        .letra { 
            position: absolute; width: 32px; height: 32px; background: #0044ff; 
            border-radius: 50%; display: flex; justify-content: center; align-items: center; 
            font-weight: bold; border: 1px solid white; font-size: 14px;
        }
        .letra.activa { background: #ffcc00; color: black; box-shadow: 0 0 20px #ffcc00; transform: scale(1.3); border: 2px solid white; }
        .letra.correcta { background: #28a745; } 
        .letra.incorrecta { background: #dc3545; }

        .panel-preguntas { 
            position: absolute; bottom: 50px; width: 100%; text-align: center;
        }
        .texto-pregunta { font-size: 1.3rem; margin-bottom: 20px; min-height: 60px; padding: 0 20px; }
    </style>
</head>
<body>

    <div id="p-nombre" class="pantalla">
        <h1 class="titulo">BIENVENIDO</h1>
        <p>Introduce tu nombre para empezar:</p>
        <input type="text" id="mi-nombre" placeholder="Nombre de usuario">
        <button class="btn btn-green" onclick="guardarNombre()">ENTRAR</button>
    </div>

    <div id="p-menu" class="pantalla oculto">
        <h1 class="titulo">PASAPALABRA</h1>
        <h3 id="saludo" class="subtitulo">Hola, Jugador</h3>
        <button class="btn btn-blue" onclick="mostrarCrear()">CREAR SALA (HOST)</button>
        <button class="btn btn-green" onclick="mostrarUnirse()">UNIRSE A SALA</button>
    </div>

    <div id="p-crear" class="pantalla oculto">
        <h2 style="color:#ffcc00">SALA DE ESPERA</h2>
        <p>Tu código de sala:</p>
        <h1 id="host-codigo" style="font-size:3rem; margin:10px 0; letter-spacing:5px;">---</h1>
        
        <div class="lista-jugadores">
            <div id="host-j1" class="jugador-item" style="color:#2ecc71">1. Tú (Host)</div>
            <div id="host-j2" class="jugador-item esperando-text">2. Esperando rival...</div>
        </div>

        <div id="btn-start-container" style="display:none;">
            <button class="btn btn-green" onclick="hostIniciarPartida()">¡EMPEZAR YA!</button>
        </div>
        <button class="btn" style="background:transparent; border:1px solid #555" onclick="location.reload()">Cancelar</button>
    </div>

    <div id="p-unirse" class="pantalla oculto">
        <h2>UNIRSE A PARTIDA</h2>
        <input type="text" id="input-codigo" placeholder="Introduce el Código">
        <button class="btn btn-green" onclick="guestUnirse()">CONECTAR</button>
        <button class="btn" style="background:transparent" onclick="volverMenu()">Atrás</button>
    </div>

    <div id="p-lobby-guest" class="pantalla oculto">
        <h2>CONECTADO</h2>
        <p>Esperando a que el anfitrión inicie...</p>
        <div class="lista-jugadores">
            <div id="guest-j1" class="jugador-item" style="color:#3498db">1. Anfitrión</div>
            <div id="guest-j2" class="jugador-item" style="color:#2ecc71">2. Tú</div>
        </div>
        <div class="esperando-text">El anfitrión tiene el control...</div>
    </div>

    <div id="juego">
        <div id="view-j1" class="contenedor-jugador turno-activo">
            <h2 id="name-display-1" style="margin-top:20px; color:#2ecc71">JUGADOR 1</h2>
            <div id="rosco1" class="rosco-visual"></div>
            <div class="panel-preguntas" id="controls-1">
                <div id="q-text-1" class="texto-pregunta">Pregunta...</div>
                <input type="text" id="ans-1" placeholder="Respuesta">
                <button class="btn btn-green" style="width:200px; display:inline-block" onclick="validar(1)">ENVIAR</button>
                <button class="btn" style="width:100px; background:#f1c40f; color:black; display:inline-block" onclick="pasar(1)">PASO</button>
            </div>
        </div>

        <div id="view-j2" class="contenedor-jugador turno-inactivo">
            <div id="rosco2-mini" style="width:100%; height:100%; border-radius:50%; background:#333;"></div>
        </div>
    </div>

    <script>
        // --- LÓGICA DE SIMULACIÓN MULTIJUGADOR (LOCALSTORAGE) ---
        let miNombre = "";
        let miRol = ""; // 'host' o 'guest'
        let codigoSala = "";
        let nombreRival = "";
        
        // Banco de preguntas simple
        const letras = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
        const preguntas = letras.map(l => ({l:l, p:`Pregunta de prueba con la ${l}`, r:"a"})); 
        let indexP = 0;

        function guardarNombre() {
            const n = document.getElementById('mi-nombre').value;
            if(!n) return alert("Pon nombre");
            miNombre = n;
            document.getElementById('saludo').innerText = "Hola, " + miNombre;
            cambiarPantalla('p-menu');
        }

        function cambiarPantalla(id) {
            document.querySelectorAll('.pantalla').forEach(p => p.classList.add('oculto'));
            if(document.getElementById(id)) document.getElementById(id).classList.remove('oculto');
        }

        function mostrarCrear() {
            miRol = 'host';
            codigoSala = Math.floor(1000 + Math.random() * 9000); // Código 4 cifras
            document.getElementById('host-codigo').innerText = codigoSala;
            document.getElementById('host-j1').innerText = "1. " + miNombre + " (Anfitrión)";
            
            // Creamos la sala en "la nube simulada" (localStorage)
            const salaData = { estado: 'esperando', host: miNombre, guest: null, code: codigoSala };
            localStorage.setItem('sala_' + codigoSala, JSON.stringify(salaData));
            
            cambiarPantalla('p-crear');
            
            // Escuchar cambios (para cuando entre el rival)
            window.addEventListener('storage', checkSalaUpdates);
        }

        function mostrarUnirse() {
            cambiarPantalla('p-unirse');
        }

        function guestUnirse() {
            const code = document.getElementById('input-codigo').value;
            const data = localStorage.getItem('sala_' + code);
            
            if(!data) return alert("Sala no encontrada");
            
            const sala = JSON.parse(data);
            if(sala.estado !== 'esperando') return alert("La partida ya empezó o está llena");

            // Unirse
            miRol = 'guest';
            codigoSala = code;
            sala.guest = miNombre;
            sala.estado = 'lleno'; // Marcamos que ya hay 2
            localStorage.setItem('sala_' + code, JSON.stringify(sala));

            // Actualizar mi pantalla
            document.getElementById('guest-j1').innerText = "1. " + sala.host;
            document.getElementById('guest-j2').innerText = "2. " + miNombre;
            cambiarPantalla('p-lobby-guest');

            // Escuchar cuando el host le de a empezar
            window.addEventListener('storage', checkSalaUpdates);
        }

        // Esta función revisa si alguien actualizó la "base de datos"
        function checkSalaUpdates(e) {
            if(e.key === 'sala_' + codigoSala) {
                const sala = JSON.parse(e.newValue);
                
                // LÓGICA PARA EL HOST: Cuando ve que entró alguien
                if(miRol === 'host' && sala.guest && sala.estado === 'lleno') {
                    document.getElementById('host-j2').innerText = "2. " + sala.guest;
                    document.getElementById('host-j2').classList.remove('esperando-text');
                    document.getElementById('host-j2').style.color = "#3498db";
                    
                    // AQUI APARECE EL BOTÓN MAGICO
                    document.getElementById('btn-start-container').style.display = 'block';
                }

                // LÓGICA PARA EL GUEST: Cuando ve que el juego empezó
                if(miRol === 'guest' && sala.estado === 'jugando') {
                    iniciarJuegoUI();
                }
            }
        }

        function hostIniciarPartida() {
            // El host da la orden de arrancar
            const data = localStorage.getItem('sala_' + codigoSala);
            const sala = JSON.parse(data);
            sala.estado = 'jugando';
            localStorage.setItem('sala_' + codigoSala, JSON.stringify(sala));
            
            iniciarJuegoUI();
        }

        function volverMenu() { cambiarPantalla('p-menu'); }

        // --- LÓGICA DEL JUEGO VISUAL ---
        function iniciarJuegoUI() {
            document.querySelectorAll('.pantalla').forEach(p => p.classList.add('oculto'));
            document.getElementById('juego').style.display = 'block';
            
            // Dibujar rosco simple
            dibujarRosco('rosco1');
            
            // Cargar datos
            document.getElementById('name-display-1').innerText = miNombre;
            actualizarPregunta();
        }

        function dibujarRosco(id) {
            const el = document.getElementById(id);
            el.innerHTML = "";
            letras.forEach((l, i) => {
                const d = document.createElement('div');
                d.className = 'letra';
                d.id = 'l-' + i;
                d.innerText = l;
                const ang = (i * 360 / 26) - 90;
                const x = 170 * Math.cos(ang * Math.PI/180);
                const y = 170 * Math.sin(ang * Math.PI/180);
                d.style.left = `calc(50% + ${x}px - 16px)`;
                d.style.top = `calc(50% + ${y}px - 16px)`;
                el.appendChild(d);
            });
        }

        function actualizarPregunta() {
            document.getElementById('q-text-1').innerText = "CON LA " + letras[indexP] + ": Definicíón de prueba...";
            // Resaltar letra
            document.querySelectorAll('.letra').forEach(l => l.classList.remove('activa'));
            document.getElementById('l-'+indexP).classList.add('activa');
        }

        function validar(n) {
            // Lógica visual simple para demostración
            document.getElementById('l-'+indexP).classList.add('correcta');
            indexP++;
            if(indexP < letras.length) actualizarPregunta();
            document.getElementById('ans-1').value = "";
            document.getElementById('ans-1').focus();
        }

        function pasar(n) {
            indexP++;
            if(indexP < letras.length) actualizarPregunta();
        }

    </script>
</body>
</html>
